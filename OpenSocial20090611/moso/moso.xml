<?xml version="1.0" encoding="UTF-8" ?>
<Module>
	
<ModulePrefs title="みんなのMoSoトラベル" description="写真を使って行った気になるガジェットです。">
	<Require feature="opensocial-0.8"/>
	<Require feature="dynamic-height" />
</ModulePrefs>

<Optional feature="content-rewrite">
	<Param name="exclude-urls">*</Param>
</Optional>

<Content type="html" view="home,profile,canvas">
<![CDATA[
<script type="text/javascript" src="http://mizoochi.com/apps/common/opensocial-jquery.min.js"></script>
]]>
</Content>

<Content type="html" view="canvas">
<![CDATA[
<script type="text/javascript">

//外部ホストへフォームデータを送信する
function search(datas){

	//フォーム各要素のデータをオブジェクトに格納
	var setX=$("#setX").val();
	var setY=$("#setY").val();
	var setPhoto=$("#setPhoto").val();
	var comment=$("#comment").val();
	var kinds=$("#kinds").val();

	//ajax通信をおこなう
	$.ajax({
		type:'post'
		url: '',
		data: {
			"setX":setX,
			"setY":setY,
			"setPhoto":setPhoto,
			"comment":comment,
			"kinds":kinds
		},
		dataType: 'json',
		cache: true,

		//データ取得に成功した場合の処理を定義
		success: function(data, status) {
		console.log(data, status);
		

		},
		error: function(xhr, status, e) {
		console.info(xhr, status, e);
		}
	});
}

	//
/*$.ajax({
		type:'post'
		url: '/album/@me/@self',
		data: {},
		dataType: 'data'})
	.next(function(albums){
		alert(albums);
		//return [data, people[0].addresses.unstructured_address];
	});*/


function requestAlbums() {
	var idspec_params = {};
	idspec_params[opensocial.IdSpec.Field.USER_ID] = opensocial.IdSpec.PersonId.OWNER;
	var idspec = opensocial.newIdSpec(idspec_params);
	var params = {};
	req = new opensocial.newDataRequest();
	req.add(req.newFetchAlbumsRequest(idspec, params), 'albums');
	req.send(onLoadAlbums);
}

function onLoadAlbums(dataResponse){
	var albums = dataResponse.get('albums').getData();
	albums.each(function(album){
		listMediaItems(album.getField(opensocial.Album.Field.ID));
	});
}

function listMediaItems(albumId) {
	var idspec_params = {};
	idspec_params[opensocial.IdSpec.Field.USER_ID] = opensocial.IdSpec.PersonId.OWNER;
	var idspec = opensocial.newIdSpec(idspec_params);
	var req = new opensocial.newDataRequest();
	var params = {};
	req.add(req.newFetchMediaItemsRequest(idspec, albumId, params), 'mediaitems');
	req.send(onLoadMediaItems);
}

function onLoadMediaItems(dataResponse) {
	var data = 'List of MediaItems: <br><ul>';
	var mediaitems = dataResponse.get('mediaitems').getData();
	
	mediaitems.each(function(mediaitem) {
		data += '<li>';
		data += '<img src="' + mediaitem.getField(opensocial.MediaItem.Field.THUMBNAIL_URL) + '" /><br />'+mediaitem.getField(opensocial.MediaItem.Field.TITLE)+'</li>';
	});
	
	data += '</ul>';
	$("#photos").html(data);
};

requestAlbums();

</script>
<div id="viewer" style="padding:10px;">
	<div id="photos"></div>
</div>
]]>
</Content>

</Module>