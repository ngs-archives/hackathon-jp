<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<ModulePrefs
		title="チュートリアル"
		description="desc">
		<Require feature="opensocial-0.8" />
		<Require feature="dynamic-height" />
	</ModulePrefs>
	<Content type="html" view="home,profile,canvas"><![CDATA[<script type="text/javascript">
	</script>
	<div id="area" style="width: 930px; height: 200px; overflow:scroll;">
<!-- Fetching People and Friends -->
<div>
  <button onclick='fetchPeople();'>ユーザー情報の取得</button>
  <div>
    <span id='viewer'></span>
    <ul id='friends'></ul>
  </div>
</div>

<!-- Posting activity -->
<div>
  <input type='text' id='title' />
  <button onclick='postActivity();'>アクティビティー送信!</button>
  <div id='result_activity'></div>
</div>

<!-- Sharing data with friends -->
<div>
  <input type='text' id='content' />
  <button onclick='shareData();'>データ保存</button>
  <button onclick='fetchFriendData();'>友人のデータを取得</button>
  <div id='result_appdata'></div>
  <ul id='contents'></ul>
</div>
	
<!-- counter -->
<script type="text/javascript">
	function CouterInc(){
		populateMyAppData();
	}
	function getCountNum(){

		req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"viewer");
		//req.add(req.newFetchPersonAppDataRequest("VIEWER",["counter"]),"cntData");
		req.send(function(data){
			var mydata = data.get("cntData");
			document.getElementById("result_appdata").innerHTML = mydata;
		});
	}
  /**
    * Set user data
    */
   function populateMyAppData() {
     var req = opensocial.newDataRequest();
     var data1 = Math.random() * 5;
     var data2 = Math.random() * 100;
     var data3 = new Date().getTime();
     htmlout += "Setting AppField1 to " + data1 + "<br />";
     req.add(req.newUpdatePersonAppDataRequest("VIEWER", "AppField1", data1)) + "<br />";
     htmlout += "Setting AppField2 to " + data2 + "<br />";
     req.add(req.newUpdatePersonAppDataRequest("VIEWER", "AppField2", data2)) + "<br />";
     htmlout += "Setting AppField3 to " + data3 + "<br />";
     req.add(req.newUpdatePersonAppDataRequest("VIEWER", "AppField3", data3)) + "<br />";
     req.send(handlePopulateMyAppData);
   }

   /**
    * Handle responses from update person app data requests
    */
   function handlePopulateMyAppData(data) {
     if (data.hadError()) {
       htmlout += data.getErrorMessage();
     }
     requestMyData();
   }
   
   /**
    * Fetch app data
    */
   function requestMyData() {
     var req = opensocial.newDataRequest();
     var fields = [ "AppField1", "AppField2", "AppField3" ];
     req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER), "viewer");
     req.add(req.newFetchPersonAppDataRequest("VIEWER", fields), "viewer_data");
     req.send(handleRequestMyData);
   }

   /**
    * Handle responses from app data requests
    */
   function handleRequestMyData(data) {
     var mydata = data.get("viewer_data");
     var viewer = data.get("viewer");
     me = viewer.getData();

     if (mydata.hadError()) {
       htmlout += data.getErrorMessage();
       return;
     }
     // Do something with the returned data - note the getData call
     doSomethingWithMyData(mydata.getData());
   }

   /**
   * Operate on user data
   */
   function doSomethingWithMyData(data) {
     //Data is indexed by user id, and represents an object where keys 
     //correspond with the app data fields.
     var mydata = data[me.getId()];
     var div = document.getElementById('content_div');
     htmlout += "My AppField1 data is: " + mydata["AppField1"] + "<br />";
     htmlout += "My AppField2 data is: " + mydata["AppField2"] + "<br />";
     htmlout += "My AppField3 data is: " + mydata["AppField3"] + "<br />";
     div.innerHTML = htmlout;
   }

</script>
<div>
  <input type='text' id='counter' value="0" />
  <button onclick='CouterInc();'>カウントアップ</button>
  <button onclick='CouterReset();'>リセット</button>
  <div id='result_appdata'></div>
  <ul id='contents'></ul>
</div>
	

	</div>]]></Content>
</Module>
