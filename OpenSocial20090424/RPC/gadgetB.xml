<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs
  title="[RPC] goo×ホットペッパー (開発中)"
  description="[RPC] goo×ホットペッパー (開発中)"
>
<Require feature="opensocial-0.8" />
<Require feature="pubsub" />
</ModulePrefs>
<Content type="html" view="home,profile,canvas"><![CDATA[
<script type="text/javascript" src="http://d1lzci7p8hi5b7.cloudfront.net/opensocial-jquery.min.js"></script>
<script type="text/javascript">
jQuery(function($) {

  $('#form').submit(function() {
console.log(this.message.value);

    var url = 'http://webservice.recruit.co.jp/hotpepper/gourmet/v1/';
    var data = { 
      key: 'b23f89f420f6b18b', format: 'json',
      address: this.message.value
    };

    $.getJSON(url, data, function(data) {

      var shops = $('#shops').empty();

      $.each(data.results.shop, function(i, shop) {
console.log(shop.name, shop.photo.pc.s, shop.lat, shop.lng);

        var s = $('<img/>')
          .attr('alt', shop.name)
          .attr('src', shop.photo.pc.s);
          
        $('<div class="shop"/>')
          .append(s)
          .appendTo(shops);

      });
    });

    gadgets.pubsub.publish('RPC', this.message.value);
    return false;
  });

  gadgets.pubsub.subscribe('RPC', function() {
    console.log(arguments);
  });

});
</script>
<style type="text/css">
<!--

body {
  font-family: Verdana,Arial,Helvetica,sans-serif;
  font-size: .8em;
  margin: 5px;
}

#shops div.shop {
border: 1px solid black;
  width: 60px;
  float: left;
}

-->
</style>
<form id="form">
<input name="message" type="text" />
<input type="submit" />
</form>
<div id="shops">読み込み中 ...</div>

]]></Content>
</Module>
