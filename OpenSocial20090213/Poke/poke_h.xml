<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="poke">
    <Require feature="opensocial-0.8" />
  </ModulePrefs>
  <Content type="html" >
    <![CDATA[
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
    <script type="text/javascript">
      $(function(){
console.debug("init");
          myAttrs = {};

          function initMyAttrs() {
console.debug("initMyAttrs");
              masterAttrs = { item1: "善", item2: "悩", item3: "愛", item4: "H" };
              for (i in masterAttrs) {
                  myAttrs[i] = 20;
              }
              var json = gadgets.json.stringify(myAttrs);
              console.debug(json);

              var req = opensocial.newDataRequest();
              req.add(req.newUpdatePersonAppDataRequest("OWNER", 'attrs', json));
              req.send(function() { console.debug("save callback");console.debug(arguments) } );
          }

          //          initMyAttrs();
          //return;

          function getMyAttrs(initCallback, divId) {
console.debug("getMyAttrs");
//              var p = {};
//              p[opensocial.IdSpec.Field.USER_ID] = opensocial.IdSpec.PersonId.OWNER;
              var idSpec = opensocial.newIdSpec({"userId": "OWNER"});

              var req = opensocial.newDataRequest();

              req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.OWNER), 'owner');
              req.add(req.newFetchPersonAppDataRequest(idSpec, 'attrs'), "data");
              req.send(function(data) {
                   console.debug("callback");
                   myAttrs = data.get("data").getData();
                   var owner = data.get("owner").getData();
                   console.debug( myAttrs );

                   console.debug("owner_id" + owner.getId());

                   var jsonStr = myAttrs[owner.getId()]['attrs'];
                   //                                      if (!myAttrs.hasOwnProperty) {
                   //    console.debug("call init");
                   //    initCallback();
                   //    }
                   console.debug("jsonStr");
                   console.debug(jsonStr);

                   var json = gadgets.json.parse(gadgets.util.unescapeString(jsonStr));
                   console.debug("json");
                   console.debug(json);
                   //$("#" + divId).html(myAttrs);
              });
          }
          getMyAttrs(initMyAttrs, "main");
      });
    </script>
    <div id="main">あいうえお</div>
    ]]>
  </Content>
  <!--
  <Content view="profile" type="html" >
    <![CDATA[
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
    <script type="text/javascript">
      $(function(){


      });
    </script>
    ]]>
  </Content>
  <Content view="preview" type="html" >
    <![CDATA[
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
    <script type="text/javascript">
      $(function(){


      });
    </script>
    ]]>
  </Content>
  <Content view="canvas" type="html" >
    <![CDATA[
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
    <script type="text/javascript">
      $(function(){


      });
    </script>
    ]]>
  </Content>
  -->
</Module>
