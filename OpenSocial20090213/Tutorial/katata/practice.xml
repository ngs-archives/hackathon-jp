<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<ModulePrefs title="Gifts part 8 - Views">
    	<Require feature="opensocial-0.8"/>
	</ModulePrefs>
  	<Content type="html">
    <![CDATA[
      <script>
        var globalFriends = {};
		
        function loadFriends() {
          var req = opensocial.newDataRequest();
		  
          req.add(req.newFetchPersonRequest("VIEWER"), 'viewer');
		  
		  
		  var viewerFriends = opensocial.newIdSpec({"userId":"VIEWER","groupId":"FRIENDS"});
		  var opt_params = {};
		  opt_params[opensocial.DataRequest.PeopleRequestFields.MAX] = 100;
          req.add(req.newFetchPeopleRequest(viewerFriends,opt_params),'viewerFriends');
		  
		  req.send(onLoadFriends);
        }
        
        function onLoadFriends(data) {
			var viewer = data.get('viewer').getData();
			var viewerFriends = data.get('viewerFriends').getData();
			
			html = new Array();
			html.push('<select id="person">');
			viewerFriends.each(function(person) {
				if (person.getId()) {
					html.push('<option value="', person.getId(), '">', person.getDisplayName(), '</option>');
				}
			});
			html.push('</select>');
			document.getElementById('friends').innerHTML = html.join('');
          
          	globalFriends = viewerFriends;
        }
        function init() {
           loadFriends();
        }        
        gadgets.util.registerOnLoadHandler(init);
      </script>
      <div id='main'>
      </div>
    ]]>
  </Content>
</Module>