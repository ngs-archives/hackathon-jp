<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs 
    title="うごめも動画">
    <Require feature="opensocial-0.8"/>
    <Require feature="setprefs" /> 
    <Require feature="flash" /> 
    </ModulePrefs>
  <UserPref 
    name="counter" 
    default_value="0" 
    datatype="hidden"/>
<Content type="html">
<![CDATA[ 
<form name="form1">
	<input type="button" value="prev" onClick="viewJson('prev');">
	<input type="button" value="next" onClick="viewJson('next');">
</form>
<div id="hatena"></div>
<div id="movie_num"></div>
<div id="content_div"></div>

<script type="text/javascript">
<!--

UgomemoJson = "";
MovieNum = "";
MovieHatenaSyntax = "";


//JSON
function getJson(){
	var params = {};
	var url = "http://ugomemo.hatena.ne.jp/ranking/daily/movie.json?mode=total";

	params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.GET;

	params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
	gadgets.io.makeRequest(url, jsonResponse, params);
};
//Callback
function jsonResponse(obj) {
	UgomemoJson = obj.data;
	MovieNum = 0;
	var ImgSrc = UgomemoJson.items[0]["movie_animation_gif_path"];
	MovieHatenaSyntax = UgomemoJson.items[0]["movie_hatena_syntax"];
	document.getElementById("content_div").innerHTML = '<img src="'+ImgSrc+'">';
	document.getElementById("hatena").innerHTML = MovieHatenaSyntax;
	document.getElementById("movie_num").innerHTML = MovieNum;
	
};

//Movie送り
function viewJson(vector){

	if(vector == "next"){
		MovieNum++;
		if(UgomemoJson.items.length-1 < MovieNum){
			MovieNum = 0;
		}
	}else if(vector == "prev"){
		MovieNum--;
		if(MovieNum < 0){
			MovieNum = UgomemoJson.items.length-1;
		}
	}else{
		MovieNum = 0;
	}
	
	
	
	var ImgSrc = UgomemoJson.items[MovieNum]["movie_animation_gif_path"];
	MovieHatenaSyntax = UgomemoJson.items[MovieNum]["movie_hatena_syntax"];
	
	document.getElementById("content_div").innerHTML = '<img src="'+ImgSrc+'">';
	document.getElementById("hatena").innerHTML = MovieHatenaSyntax;
	document.getElementById("movie_num").innerHTML = MovieNum;

}



//onLoad
gadgets.util.registerOnLoadHandler(getJson);

-->
</script>


]]> 
	</Content>
</Module>