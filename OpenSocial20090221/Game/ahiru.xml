<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="ahiru">
    <Require feature="opensocial-0.8"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
    <script type="text/javascript" src="http://res.nicovideo.jp/js/swfobject.js?4"></script>
    <script type="text/javascript">
    gadgets.util.registerOnLoadHandler( function(){
      loadFriends();
    });

    function loadFriends(){
      var req = opensocial.newDataRequest();
      req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER), 'viewer');


      var viewerFriends = opensocial.newIdSpec({ "userId" : "VIEWER", "groupId" : "FRIENDS" });
      var opt_params = {};
      opt_params[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS] = [];
      //opt_params[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS] = [
      //  opensocial.Person.Field.AGE,
      //  opensocial.Person.Field.THUMBNAIL_URL,
      //  opensocial.Person.Field.ABOUT_ME,
      //  opensocial.Person.Field.STATUS,
      //  opensocial.Person.Field.DATE_OF_BIRTH,
      //  opensocial.Person.Field.GENDER,
      //  opensocial.Person.Field.CURRENT_LOCATION];
      opt_params[opensocial.DataRequest.PeopleRequestFields.MAX] = 100;
      req.add(req.newFetchPeopleRequest(viewerFriends, opt_params), 'friends');

      req.send(onLoadFriends);
    }

    function onLoadFriends(data){
      //var viewer = data.get('viewer').getData();
      var viewerFriends = data.get('friends').getData();

      html = new Array();
      html.push('<ul>');
      viewerFriends.each(function(person) {
        if (person.getId()) {
          html.push('<li>' + person.getDisplayName() +
            '#' + person.getId() +
            "</li>");
        }
      });
      var so = new SWFObject("http://res.nicovideo.jp/swf/rotationad.swf?081027", "rotation_anime", "100%", "100%");
      so.addParam("allowScriptAccess", "always");
      so.addParam("wmode", "transparent");
      so.write("rotation_anime_container");
      delete so;

      html.push('</ul>');
      document.getElementById('friends').innerHTML = html.join('');
    }
    </script>
    <div id='main'>
      Your friends:
      <div id='friends'></div>
    </div>
    <div id="rotation_anime_container" style="position:absolute; right:0; top:5px; width:594px; height:60px; z-index:1000;"></div>

    ]]>
  </Content>
</Module>
