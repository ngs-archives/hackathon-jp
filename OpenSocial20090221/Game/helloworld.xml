<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Gifts part 1 - Friends">
    <Require feature="opensocial-0.7"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
      <script type="text/javascript">
        gadgets.util.registerOnLoadHandler(init);

var list = [];
var viewer_id;
var viewer_name;

function init() {
	request();
}

function request() {
	var req = opensocial.newDataRequest();
	req.add(req.newFetchPersonRequest('VIEWER'), 'viewer');
	req.add(req.newFetchPeopleRequest('VIEWER_FRIENDS'), 'viewerFriends');
	req.send(response);
}


function response(data) {
  viewer = data.get("viewer").getData();
  var viewerFriends = data.get('viewerFriends').getData();
  
  viewer_id = viewer.getId();
  viewer_name = viewer.getDisplayName();
  
  id = 0;
  html = new Array();
  html.push('<table cellpadding="5"><tr>');
  viewerFriends.each(function(person) {
	
	list[ id ] = 
	var thumb = person.getField(opensocial.Person.Field.THUMBNAIL_URL);
    html.push('<td>' + '<a href="#" onClick="startGame(' + id + ');">' + '<img src="' + thumb + '">' + '</a></td>');
	id ++;
  });
  
  html.push('</tr><tr>');
  
  id = 0;
  viewerFriends.each(function(person) {
	id = person.getId();
	var thumb = person.getField(opensocial.Person.Field.THUMBNAIL_URL);
    html.push('<td>' + '<a href="#" onClick="startGame(' + id + ');">' + person.getDisplayName() + '</a>' + id + '</td>');
	id++;
  });
  
  html.push('</tr></table>');
  document.getElementById('friends').innerHTML = html.join('');
}

function startGame(id) {
	alert(id);
	alert (list[ id ]);
}

	  </script>
	  <div id="friends"></div>
   ]]>
  </Content>
</Module>
