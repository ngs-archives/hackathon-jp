<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Gifts part 1 - Friends">
    <Require feature="opensocial-0.7"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
      <script type="text/javascript">
        gadgets.util.registerOnLoadHandler(init);

var list = [];
var viewer;

function init() {
	request();
}

function request() {
	var req = opensocial.newDataRequest();
	req.add(req.newFetchPersonRequest('VIEWER'), 'viewer');
	req.add(req.newFetchPeopleRequest('VIEWER_FRIENDS'), 'viewerFriends');
	req.send(response);
}


function response(data) {
  viewer = data.get("viewer").getData();
  //var name = viewer.getDisplayName();
  //var thumb = viewer.getField(opensocial.Person.Field.THUMBNAIL_URL);
  var viewerFriends = data.get('viewerFriends').getData();
  
    
  html = new Array();
  html.push('<table cellpadding="5"><tr>');
  viewerFriends.each(function(person) {
	list[person.getId()] = person;
	var thumb = person.getField(opensocial.Person.Field.THUMBNAIL_URL);
    html.push('<td>' + '<a href="#" onClick="startGame(' + person.getId() + ');">' + '<img src="' + thumb + '">' + '</a></td>');
  });
  
  html.push('</tr><tr>');
  
  viewerFriends.each(function(person) {
	var thumb = person.getField(opensocial.Person.Field.THUMBNAIL_URL);
    html.push('<td>' + '<a href="#" onClick="startGame(' + person.getId() + ');">' + person.getDisplayName() + '</a></td>');
  });
  
  html.push('</tr></table>');
  document.getElementById('friends').innerHTML = html.join('');
}

function startGame(id) {
	alert(list[id]);
}

	  </script>
	  <div id="friends"></div>
   ]]>
  </Content>
</Module>
