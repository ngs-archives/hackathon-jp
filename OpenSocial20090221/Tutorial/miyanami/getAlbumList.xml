<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Load Album List">
    <Require feature="opensocial-0.9" />
  </ModulePrefs>
  <Content type="html">
  <![CDATA[
  <script>
    gadgets.util.registerOnLoadHandler(init);

	function fetchAlbums() {

		alert("alb1");

	  // Viewer
	  var idspec_params = {};

		alert("alb2");

	  var userId = "11386861873409637115";
	  idspec_params[opensocial.IdSpec.Field.USER_ID] = userId;

		alert("alb3");

	  var idSpec = opensocial.newIdSpec(idspec_params);
	 
		alert(idSpec);

	  var opt_params = { };
	  opt_params['albumId'] = [];
	  var req = opensocial.newDataRequest();

		alert("alb5");

	  req.add(req.newFetchAlbumsRequest(idSpec, opt_params), "albums");
	  req.send(processAlbums);
	};


	function processAlbums(data) {

	alert("prc");
	  var html = "";  
	  var albumz = data.get("albums").getData() || [];
	 
	  albumz.each(function(album) {
	     html += album.getField(opensocial.Album.Field.TITLE) + " ";
	  });

	  alert(html);
	  document.getElementById('main').innerHTML = html;

	};


    function init() {
        fetchAlbums();
    }


  </script>

  <div id='main'>
  </div>

  ]]>
  </Content>
</Module>
