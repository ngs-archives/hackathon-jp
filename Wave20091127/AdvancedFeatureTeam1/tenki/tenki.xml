<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Weather Hacks XML">
    <Require feature="rpc" />
  </ModulePrefs>

  <Content type="html">
  <![CDATA[
    <script type="text/javascript"
       src="http://wave-api.appspot.com/public/wave.js"></script>
    <script type="text/javascript">
      function makeDOMRequest() {    
        var params = {};  
        params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;  
        var url = "http://hackathon-jp.googlecode.com/svn/trunk/Wave20091127/AdvancedFeatureTeam1/tenki/tenkidata.xml";
//        var url = "http://weather.livedoor.com/forecast/webservice/rest/v1?city=113&day=tomorrow";
        gadgets.io.makeRequest(url, response, params);
        wave.log("makeDOMRequest");
        console.log("makeDOMRequest");
      };

      function response(obj) { 

        console.log("response");
        wave.log("response");

        // obj.data contains a Document DOM element corresponding to the page that was requested
        var domdata = obj.data;
        var title = domdata.getElementsByTagName("title").item(0).childNodes.item(0).nodeValue;
        var description = domdata.getElementsByTagName("description").item(0).text.nodeValue;
        var link = domdata.getElementsByTagName("link").item(0).text.nodeValue;
        var imgurl = domdata.getElementsByTagName("url").item(0).text.nodeValue;
        var imgwidth = domdata.getElementsByTagName("width").item(0).text.nodeValue;
        var imgheight = domdata.getElementsByTagName("height").item(0).text.nodeValue;



        var html = '';
        html += '<h3><a href="' + link+ '">' + title + '</h3>'; 
        html += '<p>' + description + '</p>'; 
        html += '<img border="0" src="' + imgurl;
        html += '" width="' + imgwidth;
        html += '" height="' + imgheight;
        html += '" alt="天気アイコン">';

        document.getElementById('content').innerHTML = html;
      };
      gadgets.util.registerOnLoadHandler(makeDOMRequest);
    </script>

    <div id="content"></div>
  ]]>
  </Content>
</Module>
